# outline

線分走査法を利用して下記問題を解く

+ 凸包
  + 2次元点集合を囲む最小の凸包を計算
+ 交差線分
  + 2次元線分の集合を元に交差を計算する
+ ボロノイ図
  + 2次元点集合に対する距離に基づく平面分割

## 凸包

2次元点集合が3要素あった場合、外積を用いて方向を確認する

```math
cp = \begin{vmatrix}
L_{i-1}.x & L_{i-1}.y & 1 \\
L_i.x & L_i.y & 1 \\
p.x & p.y & 1
\end{vmatrix}
```

```math
cp = (L_1.x - L_{i_1}.x)(p.y - L_{i-1}.y) - (L_1.y - L_{i-1}.y)(p.x - L_{i-1}.x)
```

```math
direction = \left\{
\begin{array}{ll}
共線 & (cp = 0) \\
右回り & (cp < 0) \\
左回り & (cp > 0) \\
\end{array}
\right.
```

一番左端の要素から開始し、右回りのものだけを抽出することで凸包特性を保持する。

例) 凸法適用前データ

```mermaid
quadrantChart
title pentagram with noise
0: [0.4744380728454538, 0.4306645779939401]
1: [0.8216274972107267, 0.3409289973287687]
2: [0.16856631177378512, 0.6321399500159504]
3: [0.8356137831791326, 0.5491591075660418]
4: [0.7016059622240661, 0.6167132193406035]
5: [0.4068312910152627, 0.18680118620224329]
6: [0.21648955293952016, 0.12581439693026086]
7: [0.646912821190588, 0.5176989926527412]
8: [0.11929743633655271, 0.5089444185603342]
9: [0.7658309406221899, 0.454021850738613]
10: [0.6979898603300022, 0.6053601368458289]
11: [0.3785913236525795, 0.5961504178766476]
12: [0.44441835135469215, 0.3668727547487034]
13: [0.4495191718718005, 0.5378207039385484]
14: [0.6520828256088895, 0.6965771356263429]
15: [0.4661969561040769, 0.3422284287826125]
16: [0.4694704684142651, 0.3786235012027299]
17: [0.7130932736429699, 0.3954728828894126]
18: [0.20622286220725727, 0.23937516060896347]
19: [0.18602639854775782, 0.7399260861155978]
20: [0.5, 1]
21: [0.02447149999999998, 0.6545085]
22: [0.2061075, 0.09549149999999995]
23: [0.7938925, 0.09549149999999995]
24: [0.9755285, 0.6545085]
```

例)凸包適用後データ

```mermaid
quadrantChart
title convec hull scan
0: [0.7938925, 0.09549149999999995]
1: [0.02447149999999998, 0.6545085]
2: [0.2061075, 0.09549149999999995]
3: [0.5, 1]
4: [0.9755285, 0.6545085]
```

## 線分交差

2次元平面で線分の集合Sが与えられたとき、全ての線分間の交点を求める
力任せに計算すると、交点の計算回数が$`C(n, 2) = n * (n - 1) / 2`$となり、処理にかかる時間は$`O(n^2)`$。

### 交点計算のやり方

#### 直線の定義(再確認)

```math
y = mx
```

$`(a, b)`$を通る線分

```math
b = ma + k \\
k = b - ma
```

$`(a, b)`$を通る線分$`(x, y)`$の定義(傾きが同じ)

```math
y = mx + k \\
y = mx + (b - ma) \\
y - b = m(x - a)
```

#### 線分について

線分$`l`$を考える。線分$`l`$は$`(x_1, y_1)`$, $`(x_2, y_2)`$を通るとして。

```math
\left\{
  \begin{array}{}
  ax_1 + by_1 + c = 0 \\
  ax_2 + by_2 + c = 0 \\
  \end{array}
\right.
```

傾きを

```math
m = \Delta y - \Delta x \\
\Delta y = y_2 - y_1 \\

\Delta x = x_2 - x_1 \\

```

として、

```math
m = (y_2 - y_1) / (x_2 - x_1) \\

m * (x_2 - x_1) =(y_2 - y_1) \\

(\Delta y / \Delta x)(x_2 - x_1) =y_2 - y_1 \\

\Delta y (x_2 - x_1) = \Delta x(y_2 - y_1) \\

\Delta yx_2 - \Delta yx_1 = \Delta xy_2 - \Delta xy_1 \\

\Delta yx_2 - \Delta yx_1 - \Delta xy_2 + \Delta xy_1 = 0 \\

(y_2 - y_1)x_2 - (y_2 - y_1)x_1 - (x_2 - x_1)y_2 + (x_2 - x_1)y_1 = 0 \\

x_2(y_2 - y_1) - x_1(y_2 - y_1) - y_2(x_2 - x_1) + y_1(x_2 - x_1) = 0 \\

x_2(y_2 - y_1) - y_2(x_2 - x_1) - x_1(y_2 - y_1) + y_1(x_2 - x_1) = 0 \\

x_2(y_2 - y_1) + y_2(x_1 - x_2) - x_1(y_2 - y_1) + y_1(x_2 - x_1) = 0
```

$`a, b, c`$を定義

```math
a = y_2 - y_1 \\

b = x_1 - x_2
```

として

```math
x_2(y_2 - y_1) + y_2(x_1 - x_2) - x_1(y_2 - y_1) + y_1(x_2 - x_1) = 0 \\

ax_2 + by_2 - x_1(y_2 - y_1) + y_1(x_2 - x_1) = 0 \\

c = y_1(x_2 - x_1) - x_1(y_2 - y_1)
```

#### 交差点の計算

2つの線分$`L = [l_1, l_2]`$を考える。各線分の傾きなどを下記の通り定義する。

```math
l_1 = [(l_1.x_1, l_1.y_1), (l_1.x_2, l_1.y_2)] \\

l_2 = [(l_2.x_1, l_2.y_1), (l_2.x_2, l_2.y_2)] \\

L_1 = (l_1.a, l_1.b, l_1.c) \\

L_2 = (l_2.a, l_2.b, l_2.c)

```

各係数からの交点$`x, y`$算出

```math
\left\{
\begin{array}{}
l_1.ax + l_1.by + l_1.c = 0 \\
l_2.ax + l_2.by + l_2.c = 0
\end{array}
\right. \\

x = (l_1.b * l_2.c - l_2.b * l_1.c) / (l_1.a * l_2.b - l_2.a * l_1.b) \\

y = (l_2.a * l_1.c - l_1.a * l_2.c) / (l_1.a * l_2.b - l_2.a * l_1.b)
```

交差判定


```math
t1 = l_1.a * l_2.x_1 + l_1.b * l_2.y_1 + l_1.c \\

t2 = l_1.a * l_2.x_2 + l_1.b * l_2.y_2 + l_1.c \\

t3 = l_2.a * l_1.x_1 + l_2.b * l_1.y_1 + l_2.c \\

t4 = l_2.a * l_1.x_2 + l_2.b * l_1.y_2 + l_2.c \\

((t1 \geqq 0 \cap t2 \leqq 0) \cup (t1 \leqq 0 \cap t2 \geqq 0) \cap \\

(t1 \geqq 0 \cap t2 \leqq 0) \cup (t1 \leqq 0 \cap t2 \geqq 0))
```

元データ

![元データ](./line_sweep_result_01.svg)